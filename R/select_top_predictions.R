#' Extract top NetworKIN predictions
#' 
#' The strongest NetworKIN predictions for each phosphosite are selected.
#' @param predictions_file `<character>` Location of the filtered NetworKIN output file
#' @param phospho_cleaned_file `<character>` Location of the cleaned phosphoproteomic file
#' generated by `networkin_input`.
#' @param output_folder `<character>` Where the output files should be stored
#' @import readr
#' @import dplyr
#' @importFrom magrittr "%>%" 
#' @export

select_top_predictions <- function(predictions_file = 'filtered_networkin_predictions.csv',
                            phospho_cleaned_file = 'phospho_clean.csv',
                              output_folder = 'data/'){
  predictions <- read_csv(paste0(output_folder, predictions_file), col_types = cols())
  phospho <- read_csv(paste0(output_folder, phospho_cleaned_file), col_types = cols()) %>%
    mutate(protein_phosphosite = paste0(substrate, ":", str_extract(MOD_RSD, '[:alnum:]+')))
  top_predictions <- predictions %>%
    group_by(protein_phosphosite) %>%
    filter(near(networkin_score, max(networkin_score))) %>% #near() is safer than == (see ?near)
    select(protein_phosphosite, "top_predicted_kinase" = `kinase_phosphatase_phospho-binding`)
  phospho_predictions <- left_join(phospho, top_predictions, by = "protein_phosphosite")
  write_csv(phospho_predictions, paste0(output_folder, "top_predictions.csv"))
}
