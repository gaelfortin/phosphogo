---
title: "Phosphoproteo data humanization"
output: html_document
---

KinomeXplorer works only on human and yeast datasets as it uses a human and yeast kinase database. Thus, even if one imports mouse protein sequences, human kinases will be outputed. Thus, either a BLAST is performed on outputed kinases to obtain mouse orthologs, or input data can be humanized. The second approach is used below.

Too long to humanize all phospho data. Instead:
1) Extract all mouse phosphorylated peptides
2) Split multiple sites
3) Humanize each site
4) NetworKIN humanized sites
5) Go back to phospho data


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(magrittr)
```

# Import raw data
```{r}
proteo <- readxl::read_xlsx("data/imported/phospho.xlsx")
ortho <- read_csv("data/imported/shared_phospho_human_mouse.csv", col_types = cols())
```

# Extract mouse phosphorylation sites
```{r}
mouse_sites <- proteo %>%  
  select(`ProteinID-Phospho:Site`, Ratio, Log2, `Adj. p-value`) %>% 
  mutate(ACC_ID_mouse = str_extract(`ProteinID-Phospho:Site`, pattern = "^[:alnum:]*"),
         MOD_RSD_mouse = str_extract(`ProteinID-Phospho:Site`, pattern = "(?<=Phospho:).*"))

```

# Isolate each phospho site
Each phospho site is isolated on a dedicated row.
```{r}
mouse_sites %<>% 
  tidyr::separate_rows(MOD_RSD_mouse, sep = "\\.") %>% 
  mutate(MOD_RSD_mouse = paste0(MOD_RSD_mouse, "-p")) #-p added for nomenclature consistency
```

# Humanize mouse sites
```{r}
  humanized_sites <- mouse_sites %>% 
    inner_join(ortho, by = c("ACC_ID_mouse", "MOD_RSD_mouse")) %>% 
  write_csv("data/outputs/humanized_phospho_results.csv")
```


# Prepare NetworKIN input
```{r}
humanized_sites %>% 
  select(ACC_ID_human, MOD_RSD_human) %>% 
  mutate(location = str_extract(MOD_RSD_human, pattern = "[:digit:]+"),
         amino_acid = str_extract(MOD_RSD_human, pattern = "^[:alpha:]")) %>% 
  select(-MOD_RSD_human) %>% 
  write_tsv("data/outputs/networKIN_input.res", col_names = FALSE)
  
```

Remark: there is no need to remove duplicates for NetworKIN as they have already been removed during the `r inner_join`.